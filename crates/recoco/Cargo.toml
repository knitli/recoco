[package]
name = "recoco"
version = { workspace = true }
edition = { workspace = true }
rust-version = { workspace = true }
license = { workspace = true }
authors = { workspace = true }
description = { workspace = true }
repository = { workspace = true }
keywords = { workspace = true }
categories = { workspace = true }

[lib]
name = "recoco"
path = "src/lib.rs"

[features]
default = ["source-local-file"]

# Sources
source-local-file = []
source-postgres = ["dep:pgvector", "recoco_utils/sqlx"]
source-s3 = ["dep:aws-config", "dep:aws-sdk-s3", "dep:aws-sdk-sqs", "dep:redis"]
source-azure = ["dep:azure_storage", "dep:azure_storage_blobs", "dep:azure_identity", "dep:azure_core"]
source-gdrive = ["dep:google-drive3", "dep:yup-oauth2", "dep:hyper-util", "dep:http-body-util", "dep:hyper-rustls"]

# Targets
target-postgres = ["source-postgres"]
target-qdrant = ["dep:qdrant-client"]
target-neo4j = ["dep:neo4rs", "recoco_utils/neo4rs"]
target-kuzu = ["target-neo4j", "dep:reqwest"]

# Functions
function-split = []
function-json = ["dep:json5"]
function-detect-lang = []
function-embed = ["dep:async-openai", "dep:google-cloud-aiplatform-v1", "dep:google-cloud-gax", "recoco_utils/openai", "dep:reqwest", "dep:json5", "recoco_utils/reqwest"]
function-extract-llm = ["dep:async-openai", "recoco_utils/openai", "dep:reqwest", "dep:json5", "recoco_utils/reqwest"]

# Legacy
legacy-states-v0 = []

# Bundles
all-sources = ["source-local-file", "source-postgres", "source-s3", "source-azure", "source-gdrive"]
all-targets = ["target-postgres", "target-qdrant", "target-neo4j", "target-kuzu"]
all-functions = ["function-split", "function-json", "function-detect-lang", "function-embed", "function-extract-llm"]
full = ["all-sources", "all-targets", "all-functions"]

[dependencies]
recoco_utils = { workspace = true, features = ["bytes_decode", "yaml", "sqlx"] }
recoco_extra_text = { workspace = true }

anyhow = { workspace = true }
async-trait = { workspace = true }
axum = { workspace = true }
axum-extra = { workspace = true }
base64 = { workspace = true }
chrono = { workspace = true }
config = { workspace = true }
const_format = { workspace = true }
futures = { workspace = true }
tracing = { workspace = true }
tracing-subscriber = { workspace = true }
log = { workspace = true }
regex = { workspace = true }
serde = { workspace = true }
serde_json = { workspace = true }
sqlx = { workspace = true }
tokio = { workspace = true }
tower = { workspace = true }
tower-http = { workspace = true }
indexmap = { workspace = true }
blake2 = { workspace = true }
pgvector = { workspace = true, optional = true }
phf = { workspace = true }
indenter = { workspace = true }
indicatif = { workspace = true }
itertools = { workspace = true }
derivative = { workspace = true }
hex = { workspace = true }
schemars = { workspace = true }
reqwest = { workspace = true, optional = true }
async-openai = { workspace = true, optional = true }

globset = { workspace = true }
unicase = { workspace = true }
google-drive3 = { workspace = true, optional = true }
hyper-util = { workspace = true, optional = true }
hyper-rustls = { workspace = true, optional = true }
yup-oauth2 = { workspace = true, optional = true }
rustls = { workspace = true }
http-body-util = { workspace = true, optional = true }
yaml-rust2 = { workspace = true }
urlencoding = { workspace = true }
qdrant-client = { workspace = true, optional = true }
uuid = { workspace = true }
tokio-stream = { workspace = true }
async-stream = { workspace = true }
neo4rs = { workspace = true, optional = true }
bytes = { workspace = true, features = ["serde"] }
rand = { workspace = true }
indoc = { workspace = true }
owo-colors = { workspace = true }
json5 = { workspace = true, optional = true }
aws-config = { workspace = true, optional = true }
aws-sdk-s3 = { workspace = true, optional = true }
aws-sdk-sqs = { workspace = true, optional = true }
time = { workspace = true }
infer = { workspace = true }
serde_with = { workspace = true }
google-cloud-aiplatform-v1 = { workspace = true, optional = true }
google-cloud-gax = { workspace = true, optional = true }

azure_identity = { workspace = true, optional = true }
azure_core = { workspace = true, optional = true }
azure_storage = { workspace = true, optional = true }
azure_storage_blobs = { workspace = true, optional = true }
serde_path_to_error = { workspace = true }
redis = { workspace = true, optional = true }
expect-test = { workspace = true }
encoding_rs = { workspace = true }
tokio-util = { workspace = true }
