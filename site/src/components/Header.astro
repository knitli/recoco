---
// Custom header with actual Knitli logo
const { pathname } = Astro.url;

// Environment-aware URL configuration
const isDev = import.meta.env.DEV;

const getSiteUrls = () => {
  if (isDev) {
    return {
      marketing: import.meta.env.PUBLIC_MARKETING_URL || 'http://localhost:4321',
      blog: import.meta.env.PUBLIC_BLOG_URL || 'http://localhost:4322',
      docs: import.meta.env.PUBLIC_DOCS_URL || 'http://localhost:4323',
    };
  }

  return {
    marketing: 'https://knitli.com',
    blog: 'https://blog.knitli.com',
    docs: 'https://docs.knitli.com',
  };
};

const urls = getSiteUrls();
const isDocsHome = pathname === '/' || pathname === '';
const shouldShowBreadcrumb = !isDocsHome;

---

<header class="docs-header">
  <div class="docs-header-content">
    <!-- Knitli Logo + Docs Section -->
    <a href={urls.marketing} class="docs-logo" aria-label="Knitli home">
      <img src={`${import.meta.env.BASE_URL}/knitli-logo.svg`} alt="Knitli" class="logo-icon" />
      <span class="logo-text">
        <span class="logo-separator">/</span>
        <span class="logo-section">docs</span>
      </span>
    </a>

    <!-- Breadcrumb -->
    {shouldShowBreadcrumb && (
      <nav class="docs-breadcrumb" aria-label="Breadcrumb">
        <a href="/">Documentation</a>
        <span class="breadcrumb-separator" aria-hidden="true">→</span>
        <a href="/ReCoco" class="breadcrumb-product">
          ReCoco
        </a>
      </nav>
    )}

    <div class="spacer"></div>

    <!-- Cross-site Navigation -->
    <nav class="docs-nav" aria-label="Site navigation">
      <a
        href="/"
        class:list={[{ active: isDocsHome }]}
        aria-current={isDocsHome ? 'page' : undefined}
      >
        Docs Home
      </a>
      <a href={urls.marketing}>
        Main Site
      </a>
      <a href={urls.blog}>
        Blog
      </a>
      <a
        href="https://github.com/knitli"
        class="external"
        target="_blank"
        rel="noopener noreferrer"
        aria-label="Knitli on GitHub (opens in new tab)"
      >
        GitHub
        <span class="external-icon" aria-hidden="true">↗</span>
      </a>
    </nav>
  </div>
</header>

<style>
  .docs-header {
    background: white;
    border-bottom: 1px solid #e5e7eb;
    border-radius: 0 0 6px 2px; /* Chamfered bottom corners only */
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .docs-header-content {
    max-width: 1400px;
    margin: 0 auto;
    padding: 1rem 2rem;
    display: flex;
    align-items: center;
    gap: 2rem;
  }

  .docs-logo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
    transition: opacity 0.2s ease;
  }

  .docs-logo:hover {
    opacity: 0.8;
  }

  .logo-icon {
    height: 32px;
    width: auto;
    flex-shrink: 0;
  }

  .logo-text {
    font-family: system-ui, -apple-system, sans-serif;
    font-size: 1.125rem;
    font-weight: 600;
    line-height: 1;
    color: #374151;
  }

  .logo-separator {
    color: #9ca3af;
    margin: 0 0.5rem;
  }

  .logo-section {
    color: #6b7280;
  }

  .docs-breadcrumb {
    display: flex;
    align-items: center;
    align-self: flex-end;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: #6b7280;
  }

  .docs-breadcrumb a {
    color: inherit;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .docs-breadcrumb a:hover {
    color: #111827;
    text-decoration: underline;
  }

  .breadcrumb-separator {
    opacity: 0.5;
  }

  .breadcrumb-product {
    font-weight: 500;
    color: #111827;
  }

  .spacer {
    flex: 1;
  }

  .docs-nav {
    display: flex;
    gap: 2rem;
    align-items: center;
  }

  .docs-nav a {
    font-size: 0.9375rem;
    color: #374151;
    text-decoration: none;
    position: relative;
    padding: 0.25rem 0;
    transition: color 0.2s ease;
  }

  .docs-nav a:hover {
    color: #111827;
  }

  .docs-nav a.active {
    color: #111827;
    font-weight: 500;
  }

  .docs-nav a.external {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
  }

  .external-icon {
    font-size: 0.75em;
    opacity: 0.6;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .docs-header-content {
      flex-wrap: wrap;
      padding: 1rem;
      gap: 1rem;
    }

    .docs-breadcrumb {
      order: 3;
      width: 100%;
    }

    .spacer {
      display: none;
    }

    .docs-nav {
      gap: 1rem;
      font-size: 0.875rem;
    }

    .logo-icon {
      height: 28px;
    }
  }
</style>
